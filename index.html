<html>
  <head>
    <title>A simple html5 canvas port of Netris (a tetris clone)</title>
    <meta name="DC.creator" content="Matthew Kanwisher, http://www.kanwisher.com/">
<!--	<meta http-equiv="refresh" content="90">  -->  <!-- for debugging -->
	<script type="text/javascript" src="js/underscore-min.js"></script>
	<script type="text/javascript" src="js/jquery-1.6.min.js"></script>
    <script type="text/javascript" src="js/netris.js"> </script>
    <script src="http://js.pusherapp.com/1.8/pusher.min.js" type="text/javascript"></script>
	  <script type="text/javascript">
	    // Enable pusher logging - don't include this in production
	    Pusher.log = function(message) {
	      if (window.console && window.console.log) window.console.log(message);
	    };

 		var logged_in_users = 0;
		function update_member_count(cnt){
			logged_in_users = cnt;
			Pusher.log ("update_member_count", cnt);
		}
		function add_member(id, info){
			
		}
		function remove_member(id, info){
			
		}
	    // Flash fallback logging - don't include this in production
	    WEB_SOCKET_DEBUG = true;
	 	var game_id = 1;

	    var pusher = new Pusher('4aeaafae8e422b589d9a');
		var channel = pusher.subscribe('presence-tetris-' + game_id);

		channel.bind('pusher:subscription_succeeded', function(members) {
		  // for example
		  debugger;
		
		  update_member_count(members.count);

		  members.each(function(member) {
		    // for example:
		    add_member(member.id, member.info);
		  })
		});
		
		channel.bind('pusher:member_added', function(member) {
		  // for example:
		  add_member(member.id, member.info);
		  Pusher.log("added member")
		});

		channel.bind('pusher:member_removed', function(member) {
		  // for example:
		  remove_member(member.id, member.info);
		});
		
		channel.bind('tetris_update', function(data) {
	      alert(data);
	    });
		
	  </script>

    <style type="text/css">
      body { margin: 20px; font-family: arial,verdana,helvetica; background: #fff;}
    dd  h1 { font-size: 140%; font-weight:normal; color: #036; border-bottom: 1px solid #ccc; }
      canvas { border: 2px solid #000; float: left; margin-right: 20px; margin-bottom: 20px; }
      pre { float:left; display:block; background: rgb(238,238,238); border: 1px dashed #666; padding: 15px 20px; margin: 0 0 10px 0; }
    </style>
  </head>

  <body onload="player1.start('1');">
    <h1>HTML5 Tetris, a port of the old irc netris</h1>
	<div style="float:left">
		<div> Player 1 </div>
    
		<div>
	      <canvas id="tetris1" width="280" height="260"></canvas>
	    </div>
		<div> Points : <div id="points1" style="display:inline"> </div> </div>
	</div>
	<div style="float:left">

		<div> Player 2 </div>

		<div>
	      <canvas id="tetris2" width="280" height="260"></canvas>
	    </div>
		<div> Points : <div id="points2" style="display:inline"> </div> </div>
	</div>
  </body>

</html>